env:
  matrix:
  - tf_version=0.11.14
  
sudo: required
language: bash
before_install:
- wget https://releases.hashicorp.com/terraform/${tf_version}/terraform_${tf_version}_linux_amd64.zip -O /tmp/terraform.zip
- sudo unzip -d /usr/local/bin/ /tmp/terraform.zip

script:
- cd ${TRAVIS_BUILD_DIR}/; terraform init || exit 1
- cd ${TRAVIS_BUILD_DIR}/; terraform validate || exit 1
- cd ${TRAVIS_BUILD_DIR}/; terraform fmt || exit 1

after_script:
  # deploy develop to the staging environment
  - provider: script
    if: env(tf_plan) = destroy
    script: 
    - bash ./tf.sh default destroy
    on:
      branch: master

  - provider: script
    if: env(tf_plan) = apply
    script: 
    - bash ./tf.sh default apply
    on:
      branch: master